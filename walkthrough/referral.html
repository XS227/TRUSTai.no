<!doctype html>
<html lang="nb">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Henvisning registreres…</title>
  </head>
  <body>
    <p>Registrerer henvisningskode…</p>
    <script>
      const path = String(window.location.pathname || '');
      const legacyMatch = path.match(/\/a\/([^/?#]+)/i);
      const shortMatch = path.match(/\/(amb[0-9a-z]+)(?:\/|$|\?|#)/i);
      const rawReferralCode = legacyMatch?.[1] || shortMatch?.[1] || '';
      const referralCode = String(rawReferralCode).trim().toLowerCase().replace(/[^a-z0-9]/g, '');

      if (referralCode) {
        const normalizedReferralCode = referralCode.startsWith('amb') ? referralCode : `amb${referralCode.slice(0, 8)}`;
        localStorage.setItem('ambassadorRef', normalizedReferralCode);
      }

      const basePathMatch = path.match(/^(.*?\/animer\/\d+)(?:\/|$)/i);
      const basePath = basePathMatch?.[1] || '';

      window.location.replace(`${basePath}/index.html`.replace(/\/\//g, '/'));
    </script>
  </body>
</html>
